2025-08-04T14:43:53.651Z [INFO] [API][PUT-pengembalian] API request started
{
  "requestId": "req-1754318633650-lf4mwx1ke",
  "timestamp": "2025-08-04T14:43:53.650Z",
  "userAgent": "PostmanRuntime/7.45.0",
  "contentLength": "264",
  "performance": {
    "timestamp": 1754318633651,
    "memory": {
      "rss": 580190208,
      "heapTotal": 382738432,
      "heapUsed": 350644464,
      "external": 4426720,
      "arrayBuffers": 441564
    }
  }
}
2025-08-04T14:43:53.656Z [INFO] [API][PUT-pengembalian] Rate limit check completed        
{
  "performance": {
    "label": "rate-limit-check",
    "duration": "0ms"
  }
}
2025-08-04T14:43:53.668Z [INFO] [API][PUT-pengembalian] Authentication completed
{
  "performance": {
    "label": "authentication",
    "duration": "7ms"
  }
}
2025-08-04T14:43:53.673Z [WARN] [API][PUT-pengembalian] Authentication failed
{
  "requestId": "req-1754318633650-lf4mwx1ke",
  "duration": 7,
  "performance": {
    "timestamp": 1754318633673,
    "memory": {
      "rss": 580481024,
      "heapTotal": 382738432,
      "heapUsed": 350943760,
      "external": 4426822,
      "arrayBuffers": 441666
    }
  }
}
 PUT /api/kasir/transaksi/TXN-20250804-001/pengembalian 401 in 331ms
2025-08-04T14:44:08.229Z [INFO] [API][PUT-pengembalian] API request started
{
  "requestId": "req-1754318648229-qb8965ycd",
  "timestamp": "2025-08-04T14:44:08.229Z",
  "userAgent": "PostmanRuntime/7.45.0",
  "contentLength": "264",
  "performance": {
    "timestamp": 1754318648229,
    "memory": {
      "rss": 585674752,
      "heapTotal": 357048320,
      "heapUsed": 343861456,
      "external": 4313631,
      "arrayBuffers": 313927
    }
  }
}
2025-08-04T14:44:08.232Z [INFO] [API][PUT-pengembalian] Rate limit check completed        
{
  "performance": {
    "label": "rate-limit-check",
    "duration": "0ms"
  }
}
2025-08-04T14:44:08.897Z [INFO] [API][PUT-pengembalian] Authentication completed
{
  "performance": {
    "label": "authentication",
    "duration": "662ms"
  }
}
2025-08-04T14:44:08.900Z [INFO] [API][PUT-pengembalian] Parameter processing completed    
{
  "performance": {
    "label": "parameter-processing",
    "duration": "0ms"
  }
}
2025-08-04T14:44:08.902Z [INFO] [API][PUT-pengembalian] Authentication and parameters processed
{
  "requestId": "req-1754318648229-qb8965ycd",
  "userId": "user_2zqMR8BytXixaDKNlvkF8Hm7pOp",
  "transactionCode": "TXN-20250804-001",
  "authDuration": 662,
  "paramDuration": 0,
  "rateLimitDuration": 0,
  "performance": {
    "timestamp": 1754318648902,
    "memory": {
      "rss": 585756672,
      "heapTotal": 357048320,
      "heapUsed": 344740360,
      "external": 4325096,
      "arrayBuffers": 333496
    }
  }
}
2025-08-04T14:44:08.904Z [INFO] [API][PUT-pengembalian] URL parsing completed
{
  "performance": {
    "label": "url-parsing",
    "duration": "0ms"
  }
}
2025-08-04T14:44:08.907Z [INFO] [API][PUT-pengembalian] Parameter validation completed    
{
  "performance": {
    "label": "parameter-validation",
    "duration": "1ms"
  }
}
2025-08-04T14:44:08.911Z [INFO] [API][PUT-pengembalian] Request body parsing completed
{
  "performance": {
    "label": "body-parsing",
    "duration": "1ms"
  }
}
2025-08-04T14:44:08.914Z [INFO] [API][PUT-pengembalian] Request body validation completed 
{
  "performance": {
    "label": "body-validation",
    "duration": "1ms"
  }
}
2025-08-04T14:44:08.918Z [INFO] [API][PUT-pengembalian] Request validation completed      
{
  "requestId": "req-1754318648229-qb8965ycd",
  "paramType": "code",
  "includeDetails": false,
  "itemCount": 1,
  "urlParsingDuration": 0,
  "paramValidationDuration": 1,
  "bodyParsingDuration": 1,
  "validationDuration": 1,
  "performance": {
    "timestamp": 1754318648918,
    "memory": {
      "rss": 585773056,
      "heapTotal": 357048320,
      "heapUsed": 344833400,
      "external": 4325360,
      "arrayBuffers": 333760
    }
  }
}
2025-08-04T14:44:08.921Z [INFO] [API][PUT-pengembalian] Return service initialized        
{
  "performance": {
    "label": "service-initialization",
    "duration": "0ms"
  }
}
2025-08-04T14:44:12.771Z [DEBUG] [API][PUT-pengembalian] Transaction code resolved to ID
{
  "requestId": "req-1754318648229-qb8965ycd",
  "transactionCode": "TXN-20250804-001",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "performance": {
    "timestamp": 1754318652771,
    "memory": {
      "rss": 585777152,
      "heapTotal": 357048320,
      "heapUsed": 345058216,
      "external": 4325431,
      "arrayBuffers": 333831
    }
  }
}
2025-08-04T14:44:12.776Z [INFO] [API][PUT-pengembalian] Transaction lookup completed      
{
  "performance": {
    "label": "transaction-lookup",
    "duration": "3853ms"
  }
}
2025-08-04T14:44:12.780Z [INFO] [API][PUT-pengembalian] Service initialization and transaction lookup completed
{
  "requestId": "req-1754318648229-qb8965ycd",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "serviceInitDuration": 0,
  "transactionLookupDuration": 3853,
  "performance": {
    "timestamp": 1754318652780,
    "memory": {
      "rss": 585777152,
      "heapTotal": 357048320,
      "heapUsed": 345073736,
      "external": 4325431,
      "arrayBuffers": 333831
    }
  }
}
2025-08-04T14:44:12.784Z [INFO] [API][PUT-pengembalian] Starting return processing
{
  "requestId": "req-1754318648229-qb8965ycd",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "itemCount": 1,
  "returnDate": "2025-08-04T10:00:00.000Z",
  "performance": {
    "timestamp": 1754318652784,
    "memory": {
      "rss": 585777152,
      "heapTotal": 357048320,
      "heapUsed": 345082360,
      "external": 4325431,
      "arrayBuffers": 333831
    }
  }
}
2025-08-04T14:44:12.787Z [INFO] [ReturnService][processReturn] Return processing started  
{
  "processId": "process-1754318652787-s2qfbsmjk",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "itemCount": 1,
  "hasReturnDate": true,
  "hasNotes": true,
  "performance": {
    "timestamp": 1754318652787,
    "memory": {
      "rss": 585777152,
      "heapTotal": 357048320,
      "heapUsed": 345092864,
      "external": 4325431,
      "arrayBuffers": 333831
    }
  }
}
2025-08-04T14:44:12.793Z [INFO] [ReturnService][processReturn] Audit start logging initiated
{
  "performance": {
    "label": "audit-start-logging",
    "duration": "0ms"
  }
}
2025-08-04T14:44:12.797Z [INFO] [ReturnService][processReturn] Starting combined validation
{
  "processId": "process-1754318652787-s2qfbsmjk",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "itemCount": 1,
  "performance": {
    "timestamp": 1754318652796,
    "memory": {
      "rss": 585781248,
      "heapTotal": 357048320,
      "heapUsed": 345123400,
      "external": 4325431,
      "arrayBuffers": 333831
    }
  }
}
2025-08-04T14:44:16.938Z [INFO] [ReturnService][processReturn] Combined validation completed
{
  "performance": {
    "label": "combined-validation",
    "duration": "4142ms"
  }
}
2025-08-04T14:44:16.943Z [INFO] [ReturnService][processReturn] Validation completed successfully
{
  "processId": "process-1754318652787-s2qfbsmjk",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "validationDuration": 4142,
  "transactionStatus": "active",
  "itemsFound": 2,
  "performance": {
    "timestamp": 1754318656943,
    "memory": {
      "rss": 585822208,
      "heapTotal": 357048320,
      "heapUsed": 345329192,
      "external": 4325488,
      "arrayBuffers": 333888
    }
  }
}
2025-08-04T14:44:16.946Z [INFO] [ReturnService][processReturn] Return date processing completed
{
  "performance": {
    "label": "date-processing",
    "duration": "0ms"
  }
}
2025-08-04T14:44:16.950Z [INFO] [ReturnService][processReturn] Audit calculation logging initiated
{
  "performance": {
    "label": "audit-calculation-logging",
    "duration": "1ms"
  }
}
2025-08-04T14:44:16.952Z [INFO] [ReturnService][processReturn] Starting penalty calculation
{
  "processId": "process-1754318652787-s2qfbsmjk",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "returnDate": "2025-08-04T10:00:00.000Z",
  "itemCount": 1,
  "performance": {
    "timestamp": 1754318656952,
    "memory": {
      "rss": 585822208,
      "heapTotal": 357048320,
      "heapUsed": 345364112,
      "external": 4325488,
      "arrayBuffers": 333888
    }
  }
}
2025-08-04T14:44:16.959Z [DEBUG] [ReturnService][calculateReturnPenalties] Penalty calculation started
{
  "calcId": "penalty-1754318656959-cvmh4fyx4",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "itemCount": 1,
  "actualReturnDate": "2025-08-04T10:00:00.000Z",
  "performance": {
    "timestamp": 1754318656959,
    "memory": {
      "rss": 585826304,
      "heapTotal": 357048320,
      "heapUsed": 345379000,
      "external": 4325488,
      "arrayBuffers": 333888
    }
  }
}
2025-08-04T14:44:18.930Z [INFO] [ReturnService][calculateReturnPenalties] Transaction query for penalty calculation completed
{
  "performance": {
    "label": "transaction-query",
    "duration": "1964ms"
  }
}
2025-08-04T14:44:18.940Z [DEBUG] [ReturnService][calculateReturnPenalties] Transaction data retrieved
{
  "calcId": "penalty-1754318656959-cvmh4fyx4",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "txQueryDuration": 1964,
  "transactionStatus": "active",
  "expectedReturnDate": "2025-08-15T00:00:00.000Z",
  "itemsCount": 2,
  "performance": {
    "timestamp": 1754318658940,
    "memory": {
      "rss": 584335360,
      "heapTotal": 357048320,
      "heapUsed": 345519688,
      "external": 4325545,
      "arrayBuffers": 333945
    }
  }
}
2025-08-04T14:44:18.958Z [INFO] [ReturnService][calculateReturnPenalties] Item preparation for penalty calculation completed
{
  "performance": {
    "label": "item-preparation",
    "duration": "1ms"
  }
}
2025-08-04T14:44:18.971Z [DEBUG] [ReturnService][calculateReturnPenalties] Items prepared for calculation
{
  "calcId": "penalty-1754318656959-cvmh4fyx4",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "itemPrepDuration": 1,
  "itemsForCalculationCount": 1,
  "performance": {
    "timestamp": 1754318658971,
    "memory": {
      "rss": 584335360,
      "heapTotal": 357048320,
      "heapUsed": 345538040,
      "external": 4325545,
      "arrayBuffers": 333945
    }
  }
}
2025-08-04T14:44:18.991Z [INFO] [ReturnService][calculateReturnPenalties] Penalty calculator execution completed
{
  "performance": {
    "label": "penalty-calculator",
    "duration": "4ms"
  }
}
2025-08-04T14:44:19.000Z [INFO] [ReturnService][calculateReturnPenalties] Penalty calculation completed
{
  "calcId": "penalty-1754318656959-cvmh4fyx4",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "calculationDuration": 4,
  "totalDuration": 1969,
  "totalPenalty": 0,
  "totalLateDays": 0,
  "itemPenaltiesCount": 1,
  "performanceBreakdown": {
    "transactionQuery": 1964,
    "itemPreparation": 1,
    "penaltyCalculation": 4
  },
  "performance": {
    "timestamp": 1754318658999,
    "memory": {
      "rss": 584343552,
      "heapTotal": 357048320,
      "heapUsed": 345569176,
      "external": 4325545,
      "arrayBuffers": 333945
    }
  }
}
2025-08-04T14:44:19.009Z [INFO] [ReturnService][processReturn] Penalty calculation completed
{
  "performance": {
    "label": "penalty-calculation",
    "duration": "2057ms"
  }
}
2025-08-04T14:44:19.015Z [INFO] [ReturnService][processReturn] Penalty calculation completed
{
  "processId": "process-1754318652787-s2qfbsmjk",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "penaltyCalculationDuration": 2057,
  "calculationDuration": 2052,
  "totalPenalty": 0,
  "totalLateDays": 0,
  "itemPenaltiesCount": 1,
  "performance": {
    "timestamp": 1754318659014,
    "memory": {
      "rss": 584343552,
      "heapTotal": 357048320,
      "heapUsed": 345586976,
      "external": 4325545,
      "arrayBuffers": 333945
    }
  }
}
2025-08-04T14:44:19.021Z [INFO] [ReturnService][processReturn] Audit penalty logging initiated
{
  "performance": {
    "label": "audit-penalty-logging",
    "duration": "1ms"
  }
}
2025-08-04T14:44:19.026Z [INFO] [ReturnService][processReturn] Audit processing logging initiated
{
  "performance": {
    "label": "audit-processing-logging",
    "duration": "1ms"
  }
}
2025-08-04T14:44:19.029Z [INFO] [ReturnService][processReturn] Starting database transaction
{
  "processId": "process-1754318652787-s2qfbsmjk",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "totalPenalty": 0,
  "itemsToProcess": 1,
  "performance": {
    "timestamp": 1754318659029,
    "memory": {
      "rss": 584351744,
      "heapTotal": 357048320,
      "heapUsed": 345640024,
      "external": 4325545,
      "arrayBuffers": 333945
    }
  }
}
2025-08-04T14:44:19.448Z [DEBUG] [ReturnService][processReturn] Transaction started
{
  "processId": "process-1754318652787-s2qfbsmjk",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "timestamp": "2025-08-04T14:44:19.447Z",
  "performance": {
    "timestamp": 1754318659447,
    "memory": {
      "rss": 584388608,
      "heapTotal": 357048320,
      "heapUsed": 345772704,
      "external": 4325602,
      "arrayBuffers": 334002
    }
  }
}
2025-08-04T14:44:19.785Z [INFO] [ReturnService][processReturn] Transaction status update completed
{
  "performance": {
    "label": "transaction-update",
    "duration": "327ms"
  }
}
2025-08-04T14:44:19.794Z [DEBUG] [ReturnService][processReturn] Transaction status updated
{
  "processId": "process-1754318652787-s2qfbsmjk",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "newStatus": "dikembalikan",
  "returnDate": "2025-08-04T10:00:00.000Z",
  "penaltyAdded": 0,
  "txUpdateDuration": 327,
  "performance": {
    "timestamp": 1754318659793,
    "memory": {
      "rss": 584445952,
      "heapTotal": 353116160,
      "heapUsed": 344131296,
      "external": 4317260,
      "arrayBuffers": 329044
    }
  }
}
2025-08-04T14:44:19.808Z [INFO] [ReturnService][processReturn] Batch operations preparation completed
{
  "performance": {
    "label": "batch-preparation",
    "duration": "3ms"
  }
}
2025-08-04T14:44:19.828Z [DEBUG] [ReturnService][processReturn] Batch operations prepared
{
  "processId": "process-1754318652787-s2qfbsmjk",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "transactionItemUpdatesCount": 1,
  "productStockUpdatesCount": 1,
  "batchPrepDuration": 3,
  "performance": {
    "timestamp": 1754318659828,
    "memory": {
      "rss": 584445952,
      "heapTotal": 353116160,
      "heapUsed": 344169832,
      "external": 4317260,
      "arrayBuffers": 329044
    }
  }
}
2025-08-04T14:44:20.264Z [INFO] [ReturnService][processReturn] Transaction item updates completed
{
  "performance": {
    "label": "transaction-item-updates",
    "duration": "423ms"
  }
}
2025-08-04T14:44:20.670Z [INFO] [ReturnService][processReturn] Product stock updates completed
{
  "performance": {
    "label": "product-stock-updates",
    "duration": "397ms"
  }
}
2025-08-04T14:44:20.680Z [DEBUG] [ReturnService][processReturn] All database updates completed
{
  "processId": "process-1754318652787-s2qfbsmjk",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "itemUpdatesDuration": 423,
  "stockUpdatesDuration": 397,
  "productUpdatesCount": 1,
  "performance": {
    "timestamp": 1754318660680,
    "memory": {
      "rss": 584470528,
      "heapTotal": 353116160,
      "heapUsed": 344355656,
      "external": 4317374,
      "arrayBuffers": 329158
    }
  }
}
2025-08-04T14:44:20.876Z [INFO] [ReturnService][processReturn] Database transaction completed
{
  "performance": {
    "label": "database-transaction",
    "duration": "1847ms"
  }
}
2025-08-04T14:44:20.886Z [INFO] [ReturnService][processReturn] Database transaction completed successfully
{
  "processId": "process-1754318652787-s2qfbsmjk",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "dbTransactionDuration": 1847,
  "transactionInternalDuration": 1853,
  "totalPenalty": 0,
  "processedItemsCount": 1,
  "performance": {
    "timestamp": 1754318660886,
    "memory": {
      "rss": 584474624,
      "heapTotal": 353116160,
      "heapUsed": 344404568,
      "external": 4317431,
      "arrayBuffers": 329215
    }
  }
}
2025-08-04T14:44:20.898Z [INFO] [ReturnService][processReturn] Audit completion logging initiated
{
  "performance": {
    "label": "audit-completion-logging",
    "duration": "1ms"
  }
}
2025-08-04T14:44:20.908Z [INFO] [ReturnService][processReturn] Return processing completed successfully
{
  "performance": {
    "label": "total-process-process-1754318652787-s2qfbsmjk",
    "duration": "8121ms"
  }
}
2025-08-04T14:44:20.915Z [INFO] [ReturnService][processReturn] Return processing completed successfully
{
  "processId": "process-1754318652787-s2qfbsmjk",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "totalProcessDuration": 8121,
  "performanceBreakdown": {
    "auditStartLogging": 0,
    "validation": 4142,
    "dateProcessing": 0,
    "auditCalculationLogging": 1,
    "penaltyCalculation": 2057,
    "auditPenaltyLogging": 1,
    "auditProcessingLogging": 1,
    "databaseTransaction": 1847,
    "auditCompletionLogging": 1
  },
  "businessMetrics": {
    "totalPenalty": 0,
    "totalLateDays": 0,
    "processedItemsCount": 1,
    "success": true
  },
  "performance": {
    "timestamp": 1754318660915,
    "memory": {
      "rss": 584478720,
      "heapTotal": 353116160,
      "heapUsed": 344450528,
      "external": 4317431,
      "arrayBuffers": 329215
    }
  }
}
2025-08-04T14:44:20.922Z [INFO] [API][PUT-pengembalian] Return processing completed       
{
  "performance": {
    "label": "return-processing",
    "duration": "8138ms"
  }
}
2025-08-04T14:44:20.928Z [INFO] [API][PUT-pengembalian] Return processing completed successfully
{
  "requestId": "req-1754318648229-qb8965ycd",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "totalPenalty": 0,
  "processedItemsCount": 1,
  "returnProcessingDuration": 8138,
  "performance": {
    "timestamp": 1754318660928,
    "memory": {
      "rss": 584482816,
      "heapTotal": 353116160,
      "heapUsed": 344488680,
      "external": 4317431,
      "arrayBuffers": 329215
    }
  }
}
2025-08-04T14:44:20.933Z [INFO] [API][PUT-pengembalian] Response assembly completed
{
  "performance": {
    "label": "response-assembly",
    "duration": "1ms"
  }
}
2025-08-04T14:44:20.936Z [INFO] [API][PUT-pengembalian] API request completed successfully
{
  "performance": {
    "label": "total-api-request",
    "duration": "12707ms"
  }
}
2025-08-04T14:44:20.940Z [INFO] [API][PUT-pengembalian] API request completed successfully
{
  "requestId": "req-1754318648229-qb8965ycd",
  "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
  "totalApiDuration": 12707,
  "performanceBreakdown": {
    "rateLimitCheck": 0,
    "authentication": 662,
    "parameterProcessing": 0,
    "urlParsing": 0,
    "parameterValidation": 1,
    "bodyParsing": 1,
    "bodyValidation": 1,
    "serviceInitialization": 0,
    "transactionLookup": 3853,
    "returnProcessing": 8138,
    "responseAssembly": 1
  },
  "responsePayloadSize": 477,
  "success": true,
  "performance": {
    "timestamp": 1754318660940,
    "memory": {
      "rss": 584486912,
      "heapTotal": 353116160,
      "heapUsed": 344523256,
      "external": 4317431,
      "arrayBuffers": 329215
    }
  }
}
 PUT /api/kasir/transaksi/TXN-20250804-001/pengembalian 200 in 12916ms


{
    "success": true,
    "data": {
        "transaksiId": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
        "totalPenalty": 0,
        "processedItems": [
            {
                "itemId": "7940642a-9c30-4dd0-9bbb-d3ccfa530551",
                "penalty": 0,
                "kondisiAkhir": "Baik - tidak ada kerusakan",
                "statusKembali": "lengkap"
            }
        ],
        "updatedTransaction": {
            "id": "2d1276a7-e44d-4f23-bdb5-b863b3a9e3f7",
            "status": "dikembalikan",
            "tglKembali": "2025-08-04T10:00:00.000Z",
            "sisaBayar": 0
        },
        "penaltySummary": {
            "totalLateDays": 0,
            "summary": {
                "onTimeItems": 1,
                "lateItems": 0,
                "damagedItems": 0,
                "lostItems": 0
            }
        }
    },
    "message": "Pengembalian berhasil diproses untuk transaksi TXN-20250804-001. Total penalty: Rp 0"
}